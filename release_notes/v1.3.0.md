# v1.3.0 - Stability & Performance Overhaul

Aims to resolve race conditions, optimize dispatcher performance, and improve power management for Steam Deck battery life.

## Compatibility Note
- **Steam Deck (SteamOS)**: Fully supported and tested.
- **Bazzite**: Known issues with installer/patching due to read-only filesystem differences. Use v3 (Rust) on `dev` branch for Bazzite support.

---

**IMPORTANT: If upgrading from v1.2.x or earlier (including v1.3.0-rc1), run `sudo ./uninstall.sh` first to remove conflicting components from previous versions. Then run `sudo ./install.sh` for a clean installation.**

---

## Critical Fixes

- **Fixed**: Race condition causing 4+ second delays and stuttering when connecting to WiFi ([#5](https://github.com/doughty247/hifi-wifi/issues/5), [#6](https://github.com/doughty247/hifi-wifi/issues/6))
- **Fixed**: Steam Deck power save mode detection for USB-C charging
- **Fixed**: Desktop systems with wireless mice incorrectly detected as battery devices
- **Improved**: CAKE should apply in ~1 second (previously 4-8 seconds)

---

## Performance Improvements

- **Removed**: Network idle check causing 4+ second delay
- **Removed**: IFB download shaping (unreliable)
- **Added**: Link speed retry logic for wake-from-sleep scenarios
- **Added**: Timeout protection on battery/AC status reads
- **Added**: Interface filtering to skip virtual interfaces

---

## New Features

- **Added**: `uninstall.sh` script for complete removal (supports v1.0.0-v1.3.x)
- **Added**: Automatic detection of legacy installs (pre-1.3.0)
- **Added**: Post-install prompt to apply optimizations immediately
- **Improved**: `hifi-wifi --status` now uses color-coded sections

---

## Bug Fixes

- WiFi power save mode should respond to AC/battery changes
- Desktop systems should use performance mode
- Legacy install detection should work for older versions
- Version comparison should handle installs without share directory
- Uninstaller should preserve SteamOS read-only filesystem
- Recent Activity in `--status` should display correctly
- `--revert` now cleans up per-interface udev rules and NetworkManager config

---

## Known Limitations

- Power mode only updates on WiFi connect/disconnect, not on AC plug/unplug during active connection
- `--force-performance` temporarily disabled (scheduled for v1.4.0)
- **Workaround**: Disconnect/reconnect WiFi or run `sudo hifi-wifi --apply` to refresh

---

## Upgrade Instructions

```bash
# Clean upgrade (recommended)
sudo ./uninstall.sh  # Remove old version first
sudo ./install.sh    # Fresh install

# Or in-place upgrade
sudo ./install.sh    # Automatically updates all components including dispatcher

# Verify optimizations are active
sudo hifi-wifi --apply
```

---

## Supported Platforms

- Steam Deck (USB-C charging)
- Bazzite/SteamOS laptops (AC adapters)
- Bazzite/SteamOS desktops

---

## Statistics

- Code removed: ~150 lines
- Commits: 9
- Issues addressed: #5, #6
- Apply time: ~1 second (previously 4-8 seconds)
