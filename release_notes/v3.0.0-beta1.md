# hifi-wifi v3.0.0-beta1 Release Notes

**Release Date:** January 11, 2026
**Status:** Beta - Ready for Testing

> [!IMPORTANT]  
> **Upgrading from v1.x?**  
> **If you have hifi-wifi v1.3.0 or earlier installed, you MUST uninstall it first to remove legacy scripts:**
> ```bash
> # From within the new v3.0 folder:
> cd legacy
> sudo ./uninstall.sh
> cd ..
> ```

---


**hifi-wifi v3.0** is a complete rewrite of the project in Rust, designed to be a set-and-forget network optimizer for Linux handhelds (Steam Deck, Bazzite, Arch). It runs as a background systemd service (~12MB RAM, <1% CPU) to dynamically manage traffic shaping, power settings, and latency. Why version 3? Because it's more than a version 2 lol.

**Key Benefits:**
- **Eliminates Bufferbloat**: Adapts bandwidth limits every 2 seconds based on real-time link speed.
- **Smart Power**: Maximizes performance on AC; saves battery when unplugged (but wakes up instantly for gaming).
- **Game Mode**: Detects high-packet-rate gaming (>200 PPS) and freezes network settings to prevent jitter.
- **Platform Resilience**: Native support for SteamOS (read-only) and Bazzite (SELinux), surviving system updates.

---

## What's New in v3.0

### 1. Breathing CAKE v2 (Dynamic QoS)
The traffic shaping engine has been redesigned for stability and responsiveness:
- **Asymmetric Response**: Drops bandwidth limits quickly (2s) to stop lag spikes, but raises them slowly (6s) to prevent oscillation.
- **Throughput Validation**: Validates driver-reported link speeds against actual measured data to ensure limits are realistic.
- **Signal Filtering**: Uses a 3-sample median filter to ignore noise (like MCS0 probe frames) without laggy averaging.
- **Dual-Source Telemetry**: Combines data from NetworkManager and `iw` to handle driver quirks.

### 2. Intelligent Power & Ethernet Management
- **Adaptive Power Save**: Automatically toggles WiFi power save based on power source and network activity (>50 PPS override).
- **Ethernet Support**: Now manages wired connections, dynamically disabling **EEE (Energy Efficient Ethernet)** on AC power to shave 50-200us of wakeup latency.
- **Jitter Prevention**: Implements hysteresis (4-6 second delays) on all state changes (Power, Coalescing, Roaming) to prevent "flapping."

### 3. Architecture & Reliability
- **Rust Rewrite**: Replaces fragile shell scripts with type-safe, async Rust (Tokio).
- **Self-Healing**: On SteamOS/Bazzite, the service automatically repairs its symlinks and permissions after system updates.
- **SELinux Support**: Correctly handles security contexts (bin_t) for Fedora-based distributions.
- **Enhanced Status**: `hifi-wifi status` now provides per-interface breakdowns of CAKE state, power modes, battery % and signal quality.

---

## Testing Guide

As this is a beta release, feedback on stability is crucial.

**Verification Checklist:**
1. **Install**: Does `./install.sh` complete without errors?
2. **Persistence**: Does the service survive a reboot?
3. **Gaming**: While playing online, does `hifi-wifi status` show `CAKE: [ACTIVE]` and `Bandwidth` stable?
4. **Power**: Unplug power - does `EEE` enable (Ethernet) or `Power Save` enable (WiFi)? Plug back in - do they disable?

**Reporting Issues:**
Run the following and attach `report.txt` to a GitHub issue:
```bash
{ hifi-wifi status; journalctl -u hifi-wifi -n 100; } > report.txt
```

---

## Installation & Usage

### Fresh Install / Upgrade
1. Download the Source Code (zip/tar.gz) from the [release page](https://github.com/doughty247/hifi-wifi/releases/tag/v3.0.0-beta1).
2. Extract the archive and enter the folder.
3. Run the installer:
```bash
# Installs Rust (if needed), builds binary, and sets up systemd
sudo ./install.sh
```

### Commands
| Command | Description |
|---------|-------------|
| `hifi-wifi status` | Show detailed optimization state & stats |
| `sudo hifi-wifi monitor` | Run foreground daemon with live logs |
| `sudo hifi-wifi apply` | Apply optimizations once (no daemon) |
| `sudo hifi-wifi on/off` | Start/Stop service (useful for A/B testing) |

### Configuration (Optional)
Defaults are located in `/etc/hifi-wifi/config.toml`. Key options:
```toml
[governor]
game_mode_pps_threshold = 200    # Packet rate to trigger Game Mode
game_mode_freeze_cake = true     # Lock bandwidth during gaming
```

---

## Supported Hardware
- **Platforms**: Bazzite (Recommended), SteamOS 3.x, Arch Linux, Fedora.
- **WiFi**: Intel (iwlwifi), Qualcomm (ath11k - Steam Deck OLED), Realtek, MediaTek.
- **Ethernet**: Realtek, Intel.

## Known Issues
- **Initial Warmup**: CAKE bandwidth may show low for the first 4-6 seconds while the median filter fills.
- **Scanning**: Band steering requests a scan; actual roaming is decided by the firmware/driver.
- **SteamOS Persistence**: Service does not survive SteamOS system updates or branch switches (stable/beta/preview). After an update, you must re-run `sudo /var/lib/hifi-wifi/hifi-wifi install` to restore the service. *(Fixed in v3.0.0-beta2 with automatic bootstrap timer)*
